############################################################
# Tsunagari Tile Engine primary source Makefile (gnu make) #
############################################################


### --- VARIABLES SECTION --- ###

# Compiler to use. (Suggested: "g++" or "clang")
CXX = g++

# Warning flags to enable.
WFLAGS = -Wall -Wextra -Wconversion

# Compiler and linker flags.
CXXFLAGS = $(BLDCFLAGS) -pipe -pedantic -ansi $(WFLAGS) \
	$(shell pkg-config --cflags python-2.7) $(shell xml2-config --cflags)
LDFLAGS = $(BLDLDFLAGS) -lboost_program_options -lboost_python -lgosu \
	-lphysfs $(shell pkg-config --libs python-2.7) $(shell xml2-config --libs)

# Name of testing world.
TESTWORLD = testing.world


### --- MAIN SECTION --- ###

all: tsunagari $(TESTWORLD)

depend:
	@$(CXX) $(CXXFLAGS) -MM *.cpp | perl ../scripts/filter-depend.pl

tsunagari: animation.o area.o cmd.o common.o entity.o log.o main.o math.o \
           music.o player.o python.o resourcer.o sound.o tile.o viewport.o \
	   window.o world.o xml.o
	$(CXX) -o tsunagari *.o $(LDFLAGS)

%.world: %/*
	cd $(basename $@) && zip --symlinks -r -0 ../$@ *

clean:
	$(RM) tsunagari *.o $(TESTWORLD)


### --- DEPENDS SECTION --- ###

# The following tells make when an object depends on a header so it can rebuild
# the object automatically. If an object isn't rebuilt it might crash the
# program. Generated by 'make depend'. Update if you change/add/remove
# a #include anywhere or if you add/remove a C++ file.

animation.o: animation.cpp animation.h common.h log.h math.h resourcer.h \
 sound.h xml.h
area.o: animation.h area.cpp area.h common.h config.h entity.h log.h math.h \
 music.h player.h python.h resourcer.h sound.h tile.h viewport.h window.h \
 world.h xml.h
cmd.o: cmd.cpp cmd.h common.h log.h math.h
common.o: common.cpp common.h log.h math.h
entity.o: animation.h area.h common.h config.h entity.cpp entity.h log.h \
 math.h music.h player.h python.h resourcer.h sound.h tile.h viewport.h \
 window.h xml.h
log.o: config.h log.cpp log.h
main.o: cmd.h common.h config.h log.h main.cpp math.h python.h window.h
math.o: math.cpp math.h python.h
music.o: common.h log.h math.h music.cpp music.h resourcer.h sound.h xml.h
player.o: animation.h area.h common.h config.h entity.h log.h math.h music.h \
 player.cpp player.h resourcer.h sound.h tile.h viewport.h window.h world.h \
 xml.h
python.o: animation.h area.h common.h config.h entity.h log.h math.h music.h \
 player.h python.cpp python.h resourcer.h sound.h tile.h viewport.h xml.h
resourcer.o: common.h config.h log.h math.h python.h resourcer.cpp \
 resourcer.h sound.h window.h xml.h
sound.o: python.h sound.cpp sound.h
tile.o: animation.h area.h common.h config.h entity.h log.h math.h music.h \
 player.h python.h resourcer.h sound.h tile.cpp tile.h viewport.h window.h \
 xml.h
viewport.o: animation.h area.h common.h config.h entity.h log.h math.h \
 music.h player.h resourcer.h sound.h tile.h viewport.cpp viewport.h \
 window.h xml.h
window.o: animation.h area.h common.h config.h entity.h log.h math.h music.h \
 player.h resourcer.h sound.h tile.h viewport.h window.cpp window.h world.h \
 xml.h
world.o: animation.h area.h common.h config.h entity.h log.h math.h music.h \
 player.h resourcer.h sound.h tile.h viewport.h window.h world.cpp world.h \
 xml.h
xml.o: common.h config.h log.h math.h xml.cpp xml.h
