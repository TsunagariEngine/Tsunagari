############################################################
# Tsunagari Tile Engine primary source Makefile (gnu make) #
############################################################


### --- VARIABLES SECTION --- ###

# Compiler to use. (Suggested: "g++" or "clang")
CXX = g++

# Warning flags to enable.
WFLAGS = -Wall -Wextra -Wconversion

# Internal Lua library.
LUACFLAGS = -I../deps/lua
LUALIB = ../deps/lua/liblua.a

# Libraries to include.
LIBS = $(LUALIB) -lgosu -lzip -lboost_program_options \
	$(shell xml2-config --libs)

# Compiler and linker flags.
CXXFLAGS = $(MYCFLAGS) -pedantic -ansi $(WFLAGS) \
	$(shell xml2-config --cflags) $(LUACFLAGS)
LDFLAGS = $(MYLDFLAGS) $(LIBS)

# Name of testing world.
TESTWORLD = babysfirst.world


### --- MAIN SECTION --- ###

all: tsunagari $(TESTWORLD)

depend:
	@$(CXX) $(CXXFLAGS) -MM *.cpp

gen-depend:
	@./gen-depend.pl

tsunagari: $(LUALIB) animation.o area.o cmd.o common.o entity.o entity-lua.o \
           log.o main.o player.o resourcer.o script.o script-sound.o window.o \
           world.o xml.o
	$(CXX) -o tsunagari *.o $(LDFLAGS)

%.world: %/*
	cd $(basename $@) && zip -r -0 ../$@ *

clean:
	$(RM) tsunagari *.o $(TESTWORLD)


### --- DEPENDS SECTION --- ###

# The following tells make when an object depends on a header so it can rebuild
# the object automatically. If an object isn't rebuilt it might crash the
# program. Generated by 'make gen-depend'. Update if you change/add/remove
# a #include anywhere or if you add/remove a C++ file.

animation.o: animation.cpp animation.h resourcer.h common.h log.h \
 ../deps/lua/lua.h ../deps/lua/luaconf.h ../deps/lua/lualib.h \
 ../deps/lua/lua.h ../deps/lua/lauxlib.h
area.o: area.cpp area.h \
 area-structs.h animation.h resourcer.h common.h log.h \
 ../deps/lua/lua.h ../deps/lua/luaconf.h ../deps/lua/lualib.h \
 ../deps/lua/lua.h ../deps/lua/lauxlib.h player.h entity.h window.h \
 world.h xml.h
cmd.o: cmd.cpp cmd.h common.h log.h
common.o: common.cpp common.h log.h
entity-lua.o: entity-lua.cpp entity-lua.h entity.h area-structs.h animation.h \
 resourcer.h common.h log.h ../deps/lua/lua.h \
 ../deps/lua/luaconf.h ../deps/lua/lualib.h ../deps/lua/lua.h \
 ../deps/lua/lauxlib.h script.h
entity.o: entity.cpp area.h area-structs.h animation.h \
 resourcer.h common.h log.h ../deps/lua/lua.h \
 ../deps/lua/luaconf.h ../deps/lua/lualib.h ../deps/lua/lua.h \
 ../deps/lua/lauxlib.h player.h entity.h config.h entity-lua.h script.h \
 window.h xml.h
log.o: log.cpp config.h log.h
main.o: main.cpp common.h log.h config.h cmd.h window.h
player.o: player.cpp area.h \
 area-structs.h animation.h resourcer.h common.h log.h \
 ../deps/lua/lua.h ../deps/lua/luaconf.h ../deps/lua/lualib.h \
 ../deps/lua/lua.h ../deps/lua/lauxlib.h player.h entity.h config.h \
 world.h window.h
resourcer.o: resourcer.cpp common.h log.h config.h resourcer.h \
  ../deps/lua/lua.h \
 ../deps/lua/luaconf.h ../deps/lua/lualib.h ../deps/lua/lua.h \
 ../deps/lua/lauxlib.h window.h
script-sound.o: script-sound.cpp ../deps/lua/lua.h \
 ../deps/lua/luaconf.h ../deps/lua/lualib.h ../deps/lua/lua.h \
 ../deps/lua/lauxlib.h resourcer.h common.h log.h script-sound.h \
 script.h
script.o: script.cpp common.h log.h resourcer.h ../deps/lua/lua.h \
 ../deps/lua/luaconf.h ../deps/lua/lualib.h ../deps/lua/lua.h \
 ../deps/lua/lauxlib.h script.h script-sound.h
window.o: window.cpp config.h resourcer.h common.h log.h \
 ../deps/lua/lua.h ../deps/lua/luaconf.h ../deps/lua/lualib.h \
 ../deps/lua/lua.h ../deps/lua/lauxlib.h world.h window.h
world.o: world.cpp \
 area.h area-structs.h animation.h resourcer.h common.h log.h \
 ../deps/lua/lua.h ../deps/lua/luaconf.h ../deps/lua/lualib.h \
 ../deps/lua/lua.h ../deps/lua/lauxlib.h player.h entity.h window.h \
 world.h xml.h
xml.o: xml.cpp xml.h

